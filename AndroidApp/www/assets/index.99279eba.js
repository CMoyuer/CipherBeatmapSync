import{p as e,a as t,o as r,r as s,b as n,c as o,d as a,w as i,e as l,u as c,l as u,f as d,s as p,g as f,t as m,h as v,i as h,j as y,k as b}from"./vendor.90adc082.js";function g(e,t){return new Promise(((r,s)=>{t.startsWith("/")&&(t=t.substring(1));let n=t.indexOf("/");if(n<0&&!t)return void r(e);let o="";return o=n<0?t:t.substring(0,n),e.getDirectory(o,{create:!0},(function(e){-1==n?r(e):g(e,t.substring(n+1)).then((e=>r(e))).catch(s)}),s),!0}))}function w(e,t,r,s){return new Promise(((n,o)=>(window.resolveLocalFileSystemURL(t,(t=>{g(t,r).then((t=>{t.getFile(s,{create:!0,exclusive:!1},(function(t){t.createWriter((function(t){t.onwriteend=n,t.onerror=o,t.write(e)}))}),o)}),o)}),o),!0)))}async function I(e){let t=function(e,t){let r=e.split(","),s=r[0].match(/:(.*?);/)[1],n=atob(r[1]),o=n.length,a=new Uint8Array(o);for(;o--;)a[o]=n.charCodeAt(o);return new Blob([a],{type:s})}(e.base64,e.name);await w(t,cordova.file.externalDataDirectory,"","temp.zip")}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function P(e,t){let r={code:200,data:t,message:"success"};webserver.sendResponse(e,{status:200,body:JSON.stringify(r),headers:{"Content-Type":"application/json;charset=utf-8;"}})}function A(e,t){webserver.sendResponse(e,{status:t,body:"",headers:{"Content-Type":"text/html;"}})}function T(e){console.log(e);try{if("GET"===e.method){if(function(e){if("/version"!==e.path)return!1;P(e.requestId,{agreement:"2.0.0"});return!0}(e))return}else if("POST"===e.method){if(function(e){if("/upload_beatmap"!==e.path)return!1;{let t=JSON.parse(e.body);t.base64&&t.name?I(t).then((()=>{P(e.requestId,{})})).catch((t=>{console.error(t),A(e.requestId,500)})):A(e.requestId,400)}return!0}(e))return}else if("OPTIONS"===e.method&&function(e){return function(e){webserver.sendResponse(e,{status:200,body:"",headers:{"Content-Type":"text/html;","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*"}})}(e.requestId),!0}(e))return;A(e.requestId,404)}catch(t){A(e.requestId,500),console.error(t)}}e("data-v-5e8cba6a");const E=v("Cipher谱面同步助手"),R={class:"tip"};t();const N={setup(e){r((()=>{}));const t=s({disabled:!1,type:"primary",icon:"switch"}),v=s("服务未启动");let h=!1;function y(e){e.target.blur(),"SPAN"===e.target.nodeName&&e.target.parentNode.blur(),h?(h=!1,webserver.stop(),t.value.type="primary",t.value.disabled=!1,t.value.icon="SwitchButton",v.value="服务已停止"):new Promise(((e,t)=>{let r=cordova.plugins.permissions;r.checkPermission(r.WRITE_EXTERNAL_STORAGE,(s=>{s.hasPermission?e():r.requestPermission(r.WRITE_EXTERNAL_STORAGE,(t=>{t.hasPermission&&e()}),t)}),(()=>{r.requestPermission(r.WRITE_EXTERNAL_STORAGE,(t=>{t.hasPermission&&e()}),t)}))})).then((()=>{var e,r;h=!0,t.value.type="primary",t.value.disabled=!0,t.value.icon="loading",v.value="正在启动",e=()=>{t.value.type="success",t.value.disabled=!1,t.value.icon="check",v.value="服务已启动, 本机IP: 获取中",networkinterface.getWiFiIPAddress((e=>{v.value="服务已启动, 本机IP: "+e.ip}),(e=>{console.error(e),v.value="服务已启动, 本机IP: 获取失败"}))},r=e=>{h=!1,console.error(e),alert(JSON.stringify(e)),t.value.type="danger",t.value.disabled=!1,t.value.icon="SwitchButton",v.value="启动服务时发生错误"},webserver.onRequest(T),webserver.start(e,r,25521)}))}return(e,r)=>{const s=n("el-header"),h=n("el-button"),b=n("el-main"),g=n("el-container");return o(),a(g,{style:{height:"100%"}},{default:i((()=>[l(s,{class:"title"},{default:i((()=>[E])),_:1}),l(b,null,{default:i((()=>[l(h,{circle:"",onClick:y,class:"btn-start",disabled:t.value.disabled,icon:"loading"==t.value.icon?c(u):"check"==t.value.type?c(d):c(p),type:t.value.type},null,8,["disabled","icon","type"]),f("div",R,m(v.value),1)])),_:1})])),_:1})}},__scopeId:"data-v-5e8cba6a"};const S=h({setup:e=>(e,t)=>(o(),a(N))});S.use(y,{locale:b}),S.mount("#app");
