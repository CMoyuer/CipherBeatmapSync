import{p as e,a as t,o as r,r as n,b as a,c as o,d as s,w as i,e as c,u as l,l as u,f as d,s as f,g as p,t as m,h as v,i as y,j as w,k as h}from"./vendor.90adc082.js";async function b(e,t,r,n){let a=await P(t),o=r.split("/");for(let i=0;i<o.length;i++){let e=o[i];e&&(a=await E(a,e,{create:!0,exclusive:!1}))}let s=await I(a,n,{create:!0,exclusive:!1});await function(e,t){return new Promise(((r,n)=>(e.createWriter((e=>{e.onwriteend=r,e.onerror=n,e.write(t)})),!0)))}(s,e)}async function g(e,t,r){try{let a=await P(e);a=await E(a,t,{});let o=await I(a,r,{});await(n=o,new Promise(((e,t)=>(n.remove(e,t),!0))))}catch(a){if(1===a.code)return;throw a}var n}async function A(e,t){try{let n=await P(e);n=await E(n,t,{}),await(r=n,new Promise(((e,t)=>(r.removeRecursively(e,t),!0))))}catch(n){if(1===n.code)return;throw n}var r}function P(e){return new Promise(((t,r)=>(window.resolveLocalFileSystemURL(e,t,r),!0)))}function E(e,t,r){return new Promise(((n,a)=>(e.getDirectory(t,r,n,a),!0)))}function I(e,t,r){return new Promise(((n,a)=>(e.getFile(t,r,n,a),!0)))}async function T(e){let t=(new Date).getTime()+"-"+parseInt(1e3*Math.random())+".zip",r=function(e){let t=e.split(","),r=t[0].match(/:(.*?);/)[1],n=atob(t[1]),a=n.length,o=new Uint8Array(a);for(;a--;)o[a]=n.charCodeAt(a);return new Blob([o],{type:r})}(e.base64);await b(r,cordova.file.externalDataDirectory,"",t);try{let r=cordova.file.externalRootDirectory,a="Android/data/com.bytedance.cipher/files/Ciphermap/CustomLevels/"+e.name;await A(r,a),console.log(cordova.file.externalDataDirectory+t,r+a),await function(e,t){return new Promise(((r,n)=>(zip.unzip(e,t,(e=>{0===e?r():n("Unzip failed!")})),!0)))}(cordova.file.externalDataDirectory+t,r+a)}catch(n){throw n}finally{try{await g(cordova.file.externalDataDirectory,"",t)}catch(n){}}}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function R(e,t){let r={code:200,data:t,message:"success"};webserver.sendResponse(e,{status:200,body:JSON.stringify(r),headers:{"Content-Type":"application/json;charset=utf-8;","Access-Control-Allow-Origin":"*"}})}function O(e,t,r){let n={code:t,data:{},message:r};webserver.sendResponse(e,{status:200,body:JSON.stringify(n),headers:{"Content-Type":"application/json;charset=utf-8;","Access-Control-Allow-Origin":"*"}})}function S(e){try{if("GET"===e.method){if(function(e){if("/version"!==e.path)return!1;R(e.requestId,{agreement:"2.0.0"});return!0}(e))return}else if("POST"===e.method){if(function(e){if("/upload_beatmap"!==e.path)return!1;{let t=JSON.parse(e.body);t.base64&&t.name?T(t).then((()=>{R(e.requestId,{})})).catch((t=>{console.error(t),O(e.requestId,500,t)})):O(e.requestId,400,"parameter error")}return!0}(e))return}else if("OPTIONS"===e.method&&function(e){return function(e){webserver.sendResponse(e,{status:200,body:"",headers:{"Content-Type":"text/html;","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*"}})}(e.requestId),!0}(e))return;t=e.requestId,webserver.sendResponse(t,{status:404,body:"",headers:{"Content-Type":"text/html;","Access-Control-Allow-Origin":"*"}})}catch(r){O(e.requestId,500,r),console.error(r)}var t}e("data-v-30c75a2c");const C=v("Cipher谱面同步助手"),L={class:"tip"};t();const N={setup(e){r((()=>{}));const t=n({disabled:!1,type:"primary",icon:"switch"}),v=n("服务未启动");let y=!1;function w(e){e.target.blur(),"SPAN"===e.target.nodeName&&e.target.parentNode.blur(),y?(y=!1,webserver.stop(),t.value.type="primary",t.value.disabled=!1,t.value.icon="SwitchButton",v.value="服务已停止"):new Promise(((e,t)=>{let r=cordova.plugins.permissions;r.checkPermission(r.WRITE_EXTERNAL_STORAGE,(n=>{n.hasPermission?e():r.requestPermission(r.WRITE_EXTERNAL_STORAGE,(t=>{t.hasPermission&&e()}),t)}),(()=>{r.requestPermission(r.WRITE_EXTERNAL_STORAGE,(t=>{t.hasPermission&&e()}),t)}))})).then((()=>{y=!0,t.value.type="primary",t.value.disabled=!0,t.value.icon="loading",v.value="正在启动";let e=()=>{t.value.type="success",t.value.disabled=!1,t.value.icon="check",v.value="服务已启动, 本机IP: 获取中",networkinterface.getWiFiIPAddress((e=>{v.value="服务已启动, 本机IP: "+e.ip}),(e=>{console.error(e),v.value="服务已启动, 本机IP: 获取失败"}))};!function(e,t){webserver.onRequest(S),webserver.start(e,t,25521)}(e,(r=>{"Server already running"===r?e():(y=!1,console.error(r),alert(JSON.stringify(r)),t.value.type="danger",t.value.disabled=!1,t.value.icon="SwitchButton",v.value="启动服务时发生错误")}))}))}return(e,r)=>{const n=a("el-header"),y=a("el-button"),h=a("el-main"),b=a("el-container");return o(),s(b,{style:{height:"100%"}},{default:i((()=>[c(n,{class:"title"},{default:i((()=>[C])),_:1}),c(h,{class:"main-box"},{default:i((()=>[c(y,{circle:"",onClick:w,class:"btn-start",disabled:t.value.disabled,icon:"loading"==t.value.icon?l(u):"check"==t.value.type?l(d):l(f),type:t.value.type},null,8,["disabled","icon","type"]),p("div",L,m(v.value),1)])),_:1})])),_:1})}},__scopeId:"data-v-30c75a2c"};const _=y({setup:e=>(e,t)=>(o(),s(N))});function k(){document.removeEventListener("backbutton",k,!1),window.setTimeout((()=>{document.addEventListener("backbutton",k,!1)}),1500)}_.use(w,{locale:h}),_.mount("#app"),document.addEventListener("deviceready",(function(){document.addEventListener("backbutton",k,!1)}));
